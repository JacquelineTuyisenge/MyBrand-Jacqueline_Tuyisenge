<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog-list-cards</title>
    <link rel="stylesheet" href="blog-cards.css" />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <header>
      <nav>
        <div class="logo">
          <div class="logo-letter">
            <h3><a href="index.html">J</a></h3>
          </div>
          <div class="logo-text">
            <h3><a href="index.html">Jacqueline</a></h3>
          </div>
        </div>
        <div class="menu">
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#about">About</a></li>
            <li><a href="index.html#portfolio">Portfolio</a></li>
            <li><a href="#blog">Blog</a></li>
            <li><a href="index.html#services">Services</a></li>
            <li><a href="index.html#contact">Contact</a></li>
          </ul>
        </div>
        <div><a href="signin.html" class="signin">SignIn</a></div>
        <div class="hamburger-icon">
          <i class="bx bx-menu" id="hamburger"></i>
        </div>
        <div class="exit-icon">
          <i class="bx bx-x" id="exit"></i>
        </div>
      </nav>
    </header>
    <main>
      <section class="blog-page" id="blog">
        <div>
          <h3>Blog Page</h3>
        </div>
        <span class="loader"></span>
        <div id="popup" class="popup hidden">Blog retrieval is Successful!</div>
        <div class="blog-cards" id="blogsContainer">
          <!--blog goes here from local storage-->

          <a href="blog-post-1.html" class="blog-card">
            <img src="images/student-to-swe.svg" alt="Blog-image" />
            <h4>From student to Junior software Engineer</h4>
            <div class="date-like-comments">
              <div class="date">
                <p>20th may, 2023</p>
              </div>
              <div class="like">
                <i class="bx bx-heart"></i>
                <p>20k</p>
              </div>
              <div class="comments">
                <i class="bx bx-message-rounded-dots"></i>
                <p>20</p>
              </div>
            </div>
            <p>
              Transitioning from student to Junior Software Engineer, my story
              is a dynamic exploration of coding and problem-solving.
            </p>
          </a>
          <a href="passion.html" class="blog-card">
            <img src="images/passion.svg" alt="Blog Post 1" />
            <h4>My Learning Journey</h4>
            <div class="date-like-comments">
              <div class="date">
                <p>20th may, 2023</p>
              </div>
              <div class="like">
                <i class="bx bx-heart"></i>
                <p>20k</p>
              </div>
              <div class="comments">
                <i class="bx bx-message-rounded-dots"></i>
                <p>20</p>
              </div>
            </div>
            <p>
              My Learning Journey' is a narrative of growth and triumphs in the
              ever-evolving world of software development.
            </p>
          </a>
          <a href="blog-post-1.html" class="blog-card">
            <img src="images/create-portfolio.svg" alt="Blog Post 1" />
            <h4>Do you know how to craft your portfolio?</h4>
            <div class="date-like-comments">
              <div class="date">
                <p>20th may, 2023</p>
              </div>
              <div class="like">
                <i class="bx bx-heart"></i>
                <p>20k</p>
              </div>
              <div class="comments">
                <i class="bx bx-message-rounded-dots"></i>
                <p>20</p>
              </div>
            </div>
            <p>
              Discover the art of crafting a compelling portfolio, unlocking the
              secrets to showcase your skills and make a lasting impact in the
              competitive tech industry.
            </p>
          </a>
        </div>
      </section>
    </main>

    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
    <script>
      // Add a class to the header when the user scrolls down, and remove it when they scroll to the top
      window.onscroll = function () {
        const header = document.querySelector("header");
        const scrollPosition = window.scrollY;

        if (scrollPosition > 50) {
          // Adjust the scroll position value based on your needs
          header.classList.add("sticky");
        } else {
          header.classList.remove("sticky");
        }
      };

      // js for resposive navbar
      const hamburgerIcon = document.getElementById("hamburger");
      const exitIcon = document.getElementById("exit");
      const menu = document.querySelector(".menu");

      hamburgerIcon.addEventListener("click", () => {
        menu.classList.toggle("show");
        hamburgerIcon.style.display = "none";
        exitIcon.style.display = "block";
      });

      exitIcon.addEventListener("click", () => {
        menu.classList.remove("show");
        exitIcon.style.display = "none";
        hamburgerIcon.style.display = "block";
      });

      // loader and popup

      const loader = document.querySelector(".loader");
      const popup = document.getElementById("popup");

      // function to fetch blogs from the server

      async function fetchAllBlogs() {
        loader.style.display = "block";
        try {
          const response = await fetch(
            "https://mybrand-be-ecx9.onrender.com/api/blogs"
          );

          if (!response.ok) {
            oader.style.display = "none";
            popup.classList.remove("hidden");
            popup.innerText = "Error fetching blogs";

            setTimeout(() => {
              popup.classList.add("hidden");
            }, 5000);
            throw new Error("Error fetching blogs");
          }

          const blogs = await response.json();
          loader.style.display = "none";
          popup.classList.remove("hidden");
          popup.innerText = blogs.message;

          setTimeout(() => {
            popup.classList.add("hidden");
          }, 5000);
          return blogs.data;
        } catch (error) {
          console.error("Error fetching blogs", error);
          return [];
        }
      }

      //update the landing page blog section

      async function displayBlogs() {
        const blogsContainer = document.getElementById("blogsContainer");
        blogsContainer.innerHTML = "";

        const Blogs = await fetchAllBlogs();
        Blogs.reverse().forEach((blog) => {
          const blogCard = createBlogCard(blog);
          blogsContainer.appendChild(blogCard);
        });
      }

      // create blog card element

      function createBlogCard(blog) {
        const blogCard = document.createElement("a");
        blogCard.classList.add("blog-card");
        blogCard.href = `single-blog.html?id=${blog._id}`;
        blogCard.innerHTML = `
        <img src="${blog.imageUrl}" alt="${blog.title}">
        <h4>${blog.title}</h4>
        <div class="date-like-comments">
            <div class="date">
                <p>${new Date(blog.createdAt).toLocaleDateString()}</p>
            </div>
            <div class="like">
                <i class='bx bx-heart'></i>
                <p>${blog.blogLikes.length}</p>
            </div>
            <div class="comments">
                <i class='bx bx-message-rounded-dots'></i>
                <p>${blog.blogComments.length}</p>
            </div>
        </div>
    `;
        return blogCard;
      }

      // function to handle clicking on a blog card

    function handleBlogCardClick(blogId) {
        window.location.href = `singleBlog.html?id=${blogId}`;
      }

      // add event listener to the blog cards

      async function cardsEventListener() {
         const blogsContainer = document.getElementById("blogsContainer");
         const blogs = await fetchAllBlogs();

         blogs.reverse().forEach((blog) => {
           const blogCard = createBlogCard(blog);
           blogCard.addEventListener("click", () => {
            handleBlogCardClick(blog._id);
           });
           blogsContainer.appendChild(blogCard);
         });
      }

      window.onload = function () {
        displayBlogs();
        cardsEventListener();
      };
    </script>
  </body>
</html>
